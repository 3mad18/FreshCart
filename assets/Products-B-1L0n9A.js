import{b as p,r as a,C as L,W as v,j as e,H as C,a as P,L as b,_ as r}from"./index-2eXFWlad.js";import{u as S}from"./useQuery-BJoWIzpA.js";function _(){function n(){return p.get("https://ecommerce.routemisr.com/api/v1/products")}return S({queryKey:["recentProducts"],queryFn:n,staleTime:8e4})}function F(){const{addProductToCart:n,cartItemsNo:m,setCartItemsNo:x}=a.useContext(L),{addProductToWishList:u}=a.useContext(v),[f,o]=a.useState(null),[i,d]=a.useState({});a.useEffect(()=>{const s=JSON.parse(localStorage.getItem("wishList"))||{};d(s)},[]),a.useEffect(()=>{localStorage.setItem("wishList",JSON.stringify(i))},[i]);async function h(s){o(s);try{let t=await n(s);t.data.status==="success"?(x(l=>l+1),r.success(t.data.message,{duration:2e3})):r.error(t.data.message,{duration:2e3})}catch{r.error("Failed to add product to cart.",{duration:2e3})}finally{o(null)}}let{data:c,isError:g,error:j,isLoading:w}=_();if(w)return e.jsx("div",{className:"py-8 w-full flex justify-center",children:e.jsx(C,{color:"green"})});if(g)return e.jsx("div",{className:"py-8 w-full flex justify-center",children:e.jsx("h3",{children:j})});async function y(s){try{let t=await u(s);if(t&&t.status==="success"){const l=!i[s];d(N=>({...N,[s]:l})),localStorage.setItem("wishList",JSON.stringify({...i,[s]:l})),r.success(l?"Product added to wishlist":"Product removed from wishlist",{duration:2e3})}else r.error((t==null?void 0:t.message)||"Failed to update wishlist",{duration:2e3})}catch{r.error("Failed to update wishlist. Please try again later.",{duration:2e3})}}return e.jsxs(e.Fragment,{children:[e.jsxs(P,{children:[e.jsx("meta",{charSet:"utf-8"}),e.jsx("title",{children:"Products"})]}),e.jsxs("div",{className:"frame",children:[e.jsx("h1",{className:"text-4xl font-extrabold text-green-700 text-center",children:"Shopping Now"}),e.jsx("div",{className:"flex flex-wrap",children:c==null?void 0:c.data.data.map(s=>e.jsx("div",{className:"w-full sm:w-1/2 md:w-1/3 lg:w-1/4 xl:w-1/6 px-2 py-4",children:e.jsxs("div",{className:"product shadow rounded-lg",children:[e.jsx(b,{to:`/productdetails/${s._id}/${s.category.name}`,children:e.jsx("img",{className:"w-full",src:s.imageCover,alt:s.title})}),e.jsx("span",{className:"block font-semibold mt-2 text-green-600 ml-1",children:s.category.name}),e.jsx("h3",{className:"text-lg font-normal text-gray-800 mb-4",children:s.title.split(" ").slice(0,2).join(" ")}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"price",children:[s.price," EGP"]}),e.jsx("span",{onClick:()=>y(s._id),className:`fa fa-heart fa-lg ml-12 ${i[s._id]?"text-red-600":"text-gray-300"} hover:text-red-600`}),e.jsxs("span",{className:"mr-2",children:[s.ratingsAverage," ",e.jsx("i",{className:"fas fa-star text-yellow-500"})]})]}),e.jsx("button",{onClick:()=>h(s._id),className:"btn ",children:f===s._id?e.jsx("i",{className:"fas fa-spinner fa-spin"}):"Add to cart"})]})},s._id))})]})]})}export{F as default};
