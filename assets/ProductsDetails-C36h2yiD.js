import{r as i,W as k,c as F,C as T,j as e,H as W,a as A,L as $,_ as r,b as o}from"./index-Cxz_bOWM.js";import{S as I}from"./index-CNinyQKE.js";import{u as H}from"./useQuery-BbFYDkR0.js";function O(){const{addProductToWishList:g}=i.useContext(k),{id:d,category:m}=F(),{addProductToCart:w,cartItemsNo:y,setCartItemsNo:N}=i.useContext(T),[x,f]=i.useState(null),[s,v]=i.useState(null),[p,P]=i.useState([]),[l,h]=i.useState({}),L={dots:!0,infinite:!0,speed:500,slidesToShow:1,slidesToScroll:1,arrows:!1,autoplay:!0};i.useEffect(()=>{const t=JSON.parse(localStorage.getItem("wishList"))||{};console.log("Loaded wishList from localStorage:",t),h(t)},[]),i.useEffect(()=>{localStorage.setItem("wishList",JSON.stringify(l)),console.log("Updated localStorage with wishList:",l)},[l]);async function u(t){f(t);try{const a=await w(t);if(a.data.status==="success"){let n=y+1;N(n),r.success(a.data.message,{duration:2e3})}else r.error(a.data.message,{duration:2e3})}catch{r.error("Failed to add product to cart.",{duration:2e3})}finally{f(null)}}const S=async()=>{try{const{data:t}=await o.get(`https://ecommerce.routemisr.com/api/v1/products/${d}`);t.data?v(t.data):r.error("No product found.")}catch{r.error("Failed to fetch product details.")}};async function j(t){try{let a=await g(t);if(a&&a.status==="success"){const n=!l[t];n?r.success("Product added to wishlist",{duration:2e3}):r.success("Product removed from wishlist",{duration:2e3}),h(c=>({...c,[t]:n}))}else r.error((a==null?void 0:a.message)||"Failed to update wishlist",{duration:2e3})}catch{r.error("Failed to update wishlist. Please try again later.",{duration:2e3})}}const C=async t=>{try{const{data:a}=await o.get("https://ecommerce.routemisr.com/api/v1/products"),n=a.data.filter(c=>c.category.name===t);P(n)}catch{r.error("Failed to fetch related products.")}};i.useEffect(()=>{S(),C(m)},[d,m]);const{data:R,isError:b,error:_,isLoading:E}=H({queryKey:["recentProducts"],queryFn:()=>o.get("https://ecommerce.routemisr.com/api/v1/products"),staleTime:8e4,select:t=>t.data.data});return E?e.jsx("div",{className:"py-8 w-full flex justify-center",children:e.jsx(W,{color:"green"})}):b?e.jsx("div",{className:"py-8 w-full flex justify-center",children:e.jsx("h3",{children:_.message})}):e.jsxs("div",{className:"frame",children:[e.jsxs(A,{children:[e.jsx("meta",{charSet:"utf-8"}),e.jsx("title",{children:s==null?void 0:s.title})]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between",children:[e.jsx("div",{className:"w-full md:w-1/4",children:e.jsx(I,{...L,children:s==null?void 0:s.images.map((t,a)=>e.jsx("img",{className:"w-full",src:t,alt:s==null?void 0:s.title},a))})}),e.jsxs("div",{className:"w-full md:w-3/4 px-4 pt-6",children:[e.jsx("h1",{className:"text-lg font-normal text-gray-950",children:s==null?void 0:s.title}),e.jsx("p",{className:"text-gray-600 font-light mt-4",children:s==null?void 0:s.description}),e.jsxs("div",{className:"flex justify-between items-center mt-4",children:[e.jsx("div",{children:e.jsxs("span",{children:[s==null?void 0:s.price," EGP"]})}),e.jsxs("div",{children:[e.jsx("span",{onClick:()=>j(s==null?void 0:s._id),className:`fa fa-heart fa-lg mx-2 ${l[s==null?void 0:s._id]?"text-red-600":"text-gray-300"} hover:text-red-600`}),e.jsxs("span",{children:[s==null?void 0:s.ratingsAverage," ",e.jsx("i",{className:"fas fa-star text-yellow-500"})]})]})]}),e.jsx("button",{onClick:()=>u(s==null?void 0:s._id),className:"btnDetails mt-4",children:x===(s==null?void 0:s._id)?e.jsx("i",{className:"fas fa-spinner fa-spin"}):"Add to cart"})]})]}),e.jsx("h2",{className:"font-medium text-2xl pt-8 text-green-600",children:"Similar Products"}),e.jsx("div",{className:"flex flex-wrap",children:p.map(t=>e.jsx("div",{className:"w-1/2 sm:w-1/2 md:w-1/3 lg:w-1/4 xl:w-1/6 rounded-lg p-2",children:e.jsx("div",{className:"product shadow",children:e.jsxs($,{to:`/productdetails/${t._id}/${t.category.name}`,children:[e.jsx("img",{className:"w-full",src:t.imageCover,alt:t.title}),e.jsxs("div",{className:"flex justify-between items-center mx-2 ",children:[e.jsx("span",{className:"block font-semibold mt-2 text-green-600 mx-1",children:t.category.name}),e.jsx("span",{onClick:()=>j(t._id),className:`fa fa-heart fa-lg mt-3 mx-1  hover:text-red-600 ${l[t._id]?"text-red-600":"text-gray-300"}`})]}),e.jsx("div",{className:"mx-2",children:e.jsx("h3",{className:"text-lg font-normal text-gray-800 mb-4",children:t.title.split(" ").slice(0,2).join(" ")})}),e.jsxs("div",{className:"flex justify-between items-center mx-2",children:[e.jsxs("span",{children:[t.price," EGP"]}),e.jsxs("span",{children:[t.ratingsAverage," ",e.jsx("i",{className:"fas fa-star text-yellow-500"})]})]}),e.jsx("button",{onClick:()=>u(t._id),className:"btn",children:x===t._id?e.jsx("i",{className:"fas fa-spinner fa-spin"}):"Add to cart"})]})})},t._id))})]})}export{O as default};
